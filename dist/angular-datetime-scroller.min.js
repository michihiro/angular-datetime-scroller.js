/*
 * angular-datetime-scroller v0.1.0
 * Copyright (c) 2014 Michihiro
 * License: MIT (https://github.com/michihiro/angular-datetime-scroller.js/blob/master/LICENSE)
 */
!function(){"use strict";function a(a,b){function c(b){function c(){return b._time}function d(c){var d=parseInt(f("applyInterval"),10);c=h(c),a(function(){b._time=c,b._applyTimer||(e(b._time),d>0&&(b._applyTimer=a(function(){b._applyTimer=null,b._timeAssigned!==b._time&&e(b._time)},d)))})}function e(a){b.time instanceof Date?b.time.setTime(a):b.time=a,b._timeAssigned=a}function f(a){return(b._opt||{})[a]}function g(a,c){b.$watch(a,c,!0)}function h(a){var c=b._opt;return a<+c.minTime?+c.minTime:a>+c.maxTime?+c.maxTime:+a}function i(a,c){var d=b._opt,e=moment(+d.minTime).startOf(c),f=moment(+d.maxTime).endOf(c);return e=e.isValid()?e:moment(+d.minTime),f=f.isValid()?f:moment(+d.maxTime),a>=+e&&+f>=a}function j(c){a(function(){b.tooltip=c})}angular.extend(this,{getTime:c,setTime:d,getOpt:f,watch:g,adjustTime:h,isValidTime:i,setTooltip:j})}function d(a,c,d,f){a.$watch("opt",function(){a._opt=angular.extend({},e,a.opt)},!0),a.$watch("[time, opt.minTime, opt.maxTime]",function(){a._time=f.adjustTime(a.time||Date.now())},!0),a.$watch("opt.formats",function(){var d=[].concat(a._opt.formats);a._formats&&a._formats.toString()===d.toString()||(a._formats=d,c.empty(),d.forEach(function(d){var e=$("<div></div>").appendTo(c);d=d.replace(/(^\s+|\s+$)/g,""),d&&d.length?moment(0).format(d)===d?e.text(d):(e.attr("mm-datetime-format","'"+d+"'"),b(e)(a)):e.html("&nbsp;")}))}),a.$watch("opt.tooltip",function(){if(a._opt.tooltip===!0){a.toolTop={};var c=b('<div mm-datetime-tooltip="tooltip" />');a.tooltipElem=c(a).appendTo("body")}else a.tooltipElem&&(a.tooltipElem.remove(),a.tooltipElem=null)}),c.on("$destroy",function(){a.tooltipElem&&a.tooltipElem.remove()})}var e={formats:["ll","","HH",":","mm"],minTime:-864e13,maxTime:864e13,applyInterval:void 0,showButton:void 0,tooltip:!1,readonly:!1,isUTC:!1,lang:"en"};return{restrict:"A",scope:{time:"=mmDatetime",opt:"=option"},controller:["$scope",c],link:d}}function b(a,b,c){function d(d,g,h,i){function j(a){d._stopMoveByTimer(),d._pressTimer=b(function(){d._moveBy(a)},200)}function k(){d._pressTimer&&b.cancel(d._pressTimer),d._pressTimer=null}function l(a){var b=moment(i.getTime());b.add(d._interval,a),i.isValidTime(+b,d._interval)?i.setTime(+b):g.addClass(a>0?"bounce-up":"bounce-down")}function m(a){var b=d.labels[e+a];return b&&b.valid?"":"disabled"}function n(){var b=i.getTime()||Date.now(),c=i.getOpt("lang"),e=i.getOpt("isUTC"),h=d.format;f.some(function(a){var f,g;return f=q(b,c,e),g=f.clone(),f.startOf(a),g.endOf(a),f.format(h)!==g.format(h)?!1:(d._interval=a,!0)}),a(function(){var a=g.find(".mm-datetime-label");d._labelHeight=a.height(),d._labelWidth=a.width(),p()})}function o(){var b,c=i.getTime(),f=i.getOpt("lang"),h=i.getOpt("isUTC"),j=q(c,f,h),k=j.format(d.format),l=d.labels,m=0;if(g.removeClass("bounce-up bounce-down"),d.time&&d.str!==k&&c>=l[0].time&&c<=l[l.length-1].time){for(b=0;2*e>b&&!(l[b].time>c);b++);d.inner.css({transition:"all 150ms ease",transform:"translateY("+d._labelHeight*(e-b+1)+"px)"}),m=150}d.str=k,d._setLabelsTimer&&a.cancel(d._setLabelsTimer),d._setLabelsTimer=a(p,m)}function p(){var a,b,c,f,g,h,j,k=i.getOpt("lang"),l=i.getOpt("isUTC"),m=d.labels;for(d._setLabelsTimer=null,b=i.getTime(),a=q(b,k,l),a.startOf(d._interval),h=b-+a,b=+a,d.time=b,f=-e;e>f;f++)a=q(b,k,l),a.add(d._interval,f),g=a.format(d.format),c=+a,j=i.isValidTime(c,d._interval),m[f+e]=angular.extend(m[f+e]||{},{str:g,time:c,valid:j,style:{opacity:j?1:.2,top:d._labelHeight*f+"px"}});d.inner.css({transition:"none",transform:"translateY(0)"})}function q(a,b,c){var d=moment(a);return d.lang(b),c&&d.utc(),d}angular.extend(d,{labels:[],inner:g.find(".mm-datetime-inner"),_moveBy:l,_startMoveByTimer:j,_stopMoveByTimer:k,getBtnClass:m}),i.getOpt("readonly")||c.detectMouse(d,g,h,i).setupTouchScroll(d,g,h,i).setupButtons(d,g,h,i).setupMouseWheel(d,g,h,i).setupKeyPress(d,g,h,i),i.watch("_time",o,!0),i.watch("opt",p,!0),d.$watch("format",n)}var e=5,f=["y","M","d","h","m","s","ms"];return{restrict:"A",require:"^mmDatetime",scope:{format:"=mmDatetimeFormat"},template:'<div class="mm-datetime-frame" tabindex="0"><div class="mm-datetime-inner"><div class="mm-datetime-label" style="color:transparent;position:relative">{{str}}</div><div class="mm-datetime-label" ng-repeat="l in labels track by $index" ng-style="l.style">{{l.str}}</div></div></div><button class="up" ng-class="getBtnClass(1)" ng-hide="_timeAtDragStart" data-delta="1">+</button><button class="down" ng-class="getBtnClass(-1)" ng-hide="_timeAtDragStart" data-delta="-1">-</button>',link:d}}function c(a){function b(b,c){b.$watch("tt",function(){a(function(){var a=b.tt||{};b._style={left:a.left-c.width(),top:a.top}})})}return{restrict:"A",scope:{tt:"=mmDatetimeTooltip"},template:'<div ng-show="tt.show" ng-style="_style">{{tt.str}}</div>',replace:!0,link:b}}function d(a,b,c){function d(a,b,d,e){function f(a){$(c).off("touchstart mousemove",f),"touchstart"!==a.type&&g()}function g(){b.removeClass("hover"),b.on("mouseenter",function(){b.addClass("hover")}),b.on("mouseleave touchend",function(){b.removeClass("hover")})}var h=e.getOpt("showButtons");return h!==!1&&b.addClass("hover"),h!==!0&&$(c).on("touchstart mousemove",f),this}function e(a,b,c,d){var e=new Hammer.Manager(b[0],{recognizers:[[Hammer.Pan],[Hammer.Tap]]});return e.on("panstart",function(){b.addClass("pan"),a._stopMoveByTimer(),a._timeAtDragStart=d.getTime(),a.$digest()}).on("panend",function(){b.removeClass("pan"),a._timeAtDragStart=null,a.$digest(),d.setTooltip({})}).on("panup pandown",function(c){if(a._timeAtDragStart){var e=moment(a._timeAtDragStart),f=c.deltaY/a._labelHeight;f=f>.5?f+.5|0:-.5>f?f-.5|0:0,e.add(a._interval,-f),d.isValidTime(+e,a._interval)?d.setTime(+e):b.addClass(0>f?"bounce-up":"bounce-down");var g=b.offset();d.setTooltip({top:g.top,left:g.left,str:a.str,show:!0})}}).on("tap",function(){b.find(".mm-datetime-frame").focus()}),b.on("$destroy",function(){a._mc.destroy(),a._mc=null}),a._mc=e,this}function f(a,b){var c=[];return b.find("button").each(function(b){c[b]=new Hammer.Manager(this,{recognizers:[[Hammer.Tap],[Hammer.Press]]}).on("tap",function(b){a._moveBy($(b.target).data("delta"))}).on("press",function(b){a._startMoveByTimer($(b.target).data("delta"))}).on("pressup",function(){a._stopMoveByTimer()})}),b.on("$destroy",function(){a._mcBtns.forEach(function(a){a.destroy()}),a._mcBtns=null}),a._mcBtns=c,this}function g(b,c){function d(d,e,f,g){var h=Date.now();d.preventDefault(),d.stopPropagation(),b._lastWheel+200>h||(b._lastWheel=h,b._stopMoveByTimer(),b._moveBy(-g/Math.abs(g)),c.addClass("wheel"),b._wheelTimer&&a.cancel(b._wheelTimer),b._wheelTimer=a(function(){b._wheelTimer=null,c.removeClass("wheel")},400))}var e=Hamster(c[0]);return e.wheel(d),c.on("$destroy",function(){b._hs.unwheel(d),b._hs=null}),b._hs=e,this}function h(b,c){function d(d){var e,f=Date.now(),g=d.keyCode;d.preventDefault(),d.stopImmediatePropagation(),b._lastKeydown+200>f||(b._lastKeydown=f,38===g||40===g?(b._moveBy(g-39),c.addClass("wheel"),b._keyWheelTimer&&a.cancel(b._keyWheelTimer),b._keyWheelTimer=a(function(){b._keyWheelTimer=null,c.removeClass("wheel")},500)):(37===g||39===g)&&(e=37===g?"prevAll":"nextAll",c[e]("[mm-datetime-format]:first").children("[tabindex]").focus()))}return c.on("keydown",d),c.on("$destroy",function(){c.off("keydown",d)}),this}return angular.extend(this,{detectMouse:d,setupTouchScroll:e,setupButtons:f,setupMouseWheel:g,setupKeyPress:h})}angular.module("mm-datetime-scroller",[]).directive("mmDatetime",a).directive("mmDatetimeFormat",b).directive("mmDatetimeTooltip",c).service("mmDatetimeService",d),a.$inject=["$timeout","$compile"],b.$inject=["$timeout","$interval","mmDatetimeService"],c.$inject=["$timeout"],d.$inject=["$timeout","$interval","$window"]}();