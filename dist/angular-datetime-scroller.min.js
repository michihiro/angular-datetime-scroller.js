/*
 * angular-datetime-scroller v0.1.0
 * Copyright (c) 2014 Michihiro
 * License: MIT (https://github.com/michihiro/angular-datetime-scroller.js/blob/master/LICENSE)
 */
!function(){"use strict";function a(a,b){function c(b){function c(){return b._time}function d(c){var d=parseInt(f("applyInterval"),10);c=h(c),a(function(){b._time=c,b._applyTimer||(e(b._time),d>0&&(b._applyTimer=a(function(){b._applyTimer=null,b._timeAssigned!==b._time&&e(b._time)},d)))})}function e(a){b.time instanceof Date?b.time.setTime(a):b.time=a,b._timeAssigned=a}function f(a){return(b._opt||{})[a]}function g(a,c){b.$watch(a,c,!0)}function h(a){var c=b._opt;return a<+c.minTime?+c.minTime:a>+c.maxTime?+c.maxTime:+a}function i(a,c){var d=b._opt,e=moment(+d.minTime).startOf(c),f=moment(+d.maxTime).endOf(c);return e=e.isValid()?e:moment(+d.minTime),f=f.isValid()?f:moment(+d.maxTime),a>=+e&&+f>=a}function j(c){a(function(){b.tooltip=c})}angular.extend(this,{getTime:c,setTime:d,getOpt:f,watch:g,adjustTime:h,isValidTime:i,setTooltip:j})}function d(a,c,d,f){a.$watch("opt",function(){a._opt=angular.extend({},e,a.opt)},!0),a.$watch("[time, opt.minTime, opt.maxTime]",function(){a._time=f.adjustTime(a.time||Date.now())},!0),a.$watch("opt.formats",function(){var d=[].concat(a._opt.formats);a._formats&&a._formats.toString()===d.toString()||(a._formats=d,c.empty(),d.forEach(function(d){var e=$("<div></div>").appendTo(c);d=d.replace(/(^\s+|\s+$)/g,""),d&&d.length?moment(0).format(d)===d?e.text(d):(e.attr("mm-datetime-format","'"+d+"'"),b(e)(a)):e.html("&nbsp;")}))}),a.$watch("opt.tooltip",function(){if(a._opt.tooltip===!0){a.toolTop={};var c=b('<div mm-datetime-tooltip="tooltip" />');a.tooltipElem=c(a).appendTo("body")}else a.tooltipElem&&(a.tooltipElem.remove(),a.tooltipElem=null)}),c.on("$destroy",function(){a.tooltipElem&&a.tooltipElem.remove()})}var e={formats:["ll","","HH",":","mm"],minTime:-864e13,maxTime:864e13,applyInterval:void 0,showButton:void 0,tooltip:!1,readonly:!1,isUTC:!1,lang:"en"};return{restrict:"A",scope:{time:"=mmDatetime",opt:"=option"},controller:["$scope",c],link:d}}function b(a,b,c){function d(d,j,k,l){function m(a){d._stopMoveByTimer(),d._pressTimer=b(function(){d._moveBy(a)},200)}function n(){d._pressTimer&&b.cancel(d._pressTimer),d._pressTimer=null}function o(a,b){var c=moment(b||l.getTime());c.add(d._interval,a),l.isValidTime(+c,d._interval)?l.setTime(+c):j.removeClass(g).addClass(a>0?e:f)}function p(a){var b=d.labels[h+a];return b&&b.valid?"":"disabled"}function q(){var b=l.getTime()||Date.now(),c=l.getOpt("lang"),e=l.getOpt("isUTC"),f=d.format;i.some(function(a){var g,h;return g=t(b,c,e),h=g.clone(),g.startOf(a),h.endOf(a),g.format(f)!==h.format(f)?!1:(d._interval=a,!0)}),a(function(){var a=j.find(".mm-datetime-label");d._labelHeight=a.height(),d._labelWidth=a.width(),s()})}function r(){var b,c=l.getTime(),e=l.getOpt("lang"),f=l.getOpt("isUTC"),i=t(c,e,f),k=i.format(d.format),m=d.labels,n=0;if(j.removeClass(g),d.time&&d.str!==k&&c>=m[0].time&&c<=m[m.length-1].time){for(b=0;2*h>b&&!(m[b].time>c);b++);d.inner.css({transition:"all 150ms ease",transform:"translateY("+d._labelHeight*(h-b+1)+"px)"}),n=150}d.str=k,d._setLabelsTimer&&a.cancel(d._setLabelsTimer),d._setLabelsTimer=a(s,n)}function s(){var a,b,c,e,f,g,i,j=l.getOpt("lang"),k=l.getOpt("isUTC"),m=d.labels;for(d._setLabelsTimer=null,b=l.getTime(),a=t(b,j,k),a.startOf(d._interval),g=b-+a,b=+a,d.time=b,e=-h;h>e;e++)a=t(b,j,k),a.add(d._interval,e),f=a.format(d.format),c=+a,i=l.isValidTime(c,d._interval),m[e+h]=angular.extend(m[e+h]||{},{str:f,time:c,valid:i,style:{opacity:i?1:.2,top:d._labelHeight*e+"px"}});d.inner.css({transition:"none",transform:"translateY(0)"})}function t(a,b,c){var d=moment(a);return d.lang(b),c&&d.utc(),d}angular.extend(d,{labels:[],inner:j.find(".mm-datetime-inner"),_moveBy:o,_startMoveByTimer:m,_stopMoveByTimer:n,getBtnClass:p}),l.getOpt("readonly")||c.detectMouse(d,j,k,l).setupTouchScroll(d,j,k,l).setupButtons(d,j,k,l).setupMouseWheel(d,j,k,l).setupKeyPress(d,j,k,l),l.watch("_time",r,!0),l.watch("opt",s,!0),d.$watch("format",q)}var h=5,i=["y","M","d","h","m","s","ms"];return{restrict:"A",require:"^mmDatetime",scope:{format:"=mmDatetimeFormat"},template:'<div class="mm-datetime-frame" tabindex="0"><div class="mm-datetime-inner"><div class="mm-datetime-label" style="color:transparent;position:relative">{{str}}</div><div class="mm-datetime-label" ng-repeat="l in labels track by $index" ng-style="l.style">{{l.str}}</div></div></div><button class="up" ng-class="getBtnClass(1)" ng-hide="_timeAtDragStart" data-delta="1">+</button><button class="down" ng-class="getBtnClass(-1)" ng-hide="_timeAtDragStart" data-delta="-1">-</button>',link:d}}function c(){return{restrict:"A",scope:{tt:"=mmDatetimeTooltip"},template:'<div ng-show="tt.show" ng-style="tt.style">{{tt.str}}</div>',replace:!0}}function d(a,b,c){function d(a,b,d,e){function f(a){$(c).off("touchstart mousemove",f),"touchstart"!==a.type&&g()}function g(){b.removeClass("hover"),b.on("mouseenter",function(){b.addClass("hover")}),b.on("mouseleave touchend",function(){b.removeClass("hover")})}var h=e.getOpt("showButtons");return h===!0?b.addClass("hover"):h===!1?g():$(c).on("touchstart mousemove",f),this}function e(a,b,c,d){function e(a){a.preventDefault()}var f=new Hammer.Manager(b[0],{recognizers:[[Hammer.Pan],[Hammer.Tap]]});return f.on("panstart",function(){b.addClass("pan"),a._stopMoveByTimer(),a._timeAtDragStart=d.getTime(),a.$digest()}).on("panend",function(){b.removeClass("pan"),a._timeAtDragStart=null,a.$digest(),d.setTooltip({})}).on("panup pandown",function(c){if(a._timeAtDragStart){var e=(moment(a._timeAtDragStart),-c.deltaY/a._labelHeight);e=e>.5?e+.5|0:-.5>e?e-.5|0:0,a._moveBy(e,a._timeAtDragStart);var f=b.offset();d.setTooltip({style:{top:f.top,left:f.left-a._labelWidth,fontSize:b.css("font-size")},str:a.str,show:!0})}}).on("tap",function(){b.find(".mm-datetime-frame").focus()}),b.on("touchstart mousedown",e),b.on("$destroy",function(){a._mc.destroy(),$(a._mc.element).off(e),a._mc=null}),a._mc=f,this}function f(a,b){var c=[];return b.find("button").each(function(b){c[b]=new Hammer.Manager(this,{recognizers:[[Hammer.Tap],[Hammer.Press]]}).on("tap",function(b){a._stopMoveByTimer(),a._moveBy($(b.target).data("delta"))}).on("press",function(b){a._startMoveByTimer($(b.target).data("delta"))}).on("pressup",function(){a._stopMoveByTimer()})}),b.on("$destroy",function(){a._mcBtns.forEach(function(a){a.destroy()}),a._mcBtns=null}),a._mcBtns=c,this}function g(b,c){function d(d,e,f,g){var h=Date.now();d.preventDefault(),d.stopPropagation(),b._lastWheel+200>h||(b._lastWheel=h,b._stopMoveByTimer(),b._moveBy(-g/Math.abs(g)),c.addClass("wheel"),b._wheelTimer&&a.cancel(b._wheelTimer),b._wheelTimer=a(function(){b._wheelTimer=null,c.removeClass("wheel")},400))}var e=Hamster(c[0]);return e.wheel(d),c.on("$destroy",function(){b._hs.unwheel(d),b._hs=null}),b._hs=e,this}function h(b,c){function d(d){var e,f=Date.now(),g=d.keyCode;d.preventDefault(),d.stopImmediatePropagation(),b._lastKeydown+200>f||(b._lastKeydown=f,38===g||40===g?(b._moveBy(g-39),c.addClass("wheel"),b._keyWheelTimer&&a.cancel(b._keyWheelTimer),b._keyWheelTimer=a(function(){b._keyWheelTimer=null,c.removeClass("wheel")},500)):(37===g||39===g)&&(e=37===g?"prevAll":"nextAll",c[e]("[mm-datetime-format]:first").children("[tabindex]").focus()))}return c.on("keydown",d),c.on("$destroy",function(){c.off("keydown",d)}),this}return angular.extend(this,{detectMouse:d,setupTouchScroll:e,setupButtons:f,setupMouseWheel:g,setupKeyPress:h})}var e="mm-datetime-bounce-up",f="mm-datetime-bounce-down",g=[e,f].join(" ");angular.module("mm-datetime-scroller",[]).directive("mmDatetime",a).directive("mmDatetimeFormat",b).directive("mmDatetimeTooltip",c).service("mmDatetimeService",d),a.$inject=["$timeout","$compile"],b.$inject=["$timeout","$interval","mmDatetimeService"],c.$inject=["$timeout"],d.$inject=["$timeout","$interval","$window"]}();